# ðŸ§  MVCA BRAIN ARCHITECTURE

**The Decision Engine Powering Vibe Coding Companion**

---

## ðŸŽ¯ What is MVCA Brain?

MVCA Brain is the **stateless decision engine** that:
- ðŸ“– Reads the STRATEG CONSTITUTION
- ðŸ§© Interprets user's vibe-coding input
- ðŸŒ Searches web for current solutions (when needed)
- ðŸ—ï¸ Applies constitutional mandates
- âœï¸ Generates production-ready prompts in Markdown

**Key Principle:** MVCA Brain has **NO MEMORY**. Every decision is made fresh by consulting the CONSTITUTION.

---

## ðŸ—ï¸ Architecture Overview
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INPUT                            â”‚
â”‚  "I need auth with Google/GitHub login + email/password"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              QUERY PROCESSOR                             â”‚
â”‚  File: query-processing.md                              â”‚
â”‚  â€¢ Parse intent (feature: authentication)               â”‚
â”‚  â€¢ Extract requirements (social + credential auth)      â”‚
â”‚  â€¢ Determine complexity (medium)                        â”‚
â”‚  â€¢ Identify user expertise level (non-coder)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CONSTITUTIONAL READER                            â”‚
â”‚  Fetches from GitHub constitution/                      â”‚
â”‚  â€¢ Segment 1: Security mandates                         â”‚
â”‚  â€¢ Segment 2: Scaffolding Pattern                       â”‚
â”‚  â€¢ Segment 2: Context Engineering (5-layer stack)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           WEB SEARCH (OPTIONAL)                          â”‚
â”‚  When constitutional guidance needs current data:        â”‚
â”‚  â€¢ Latest NextAuth.js version                           â”‚
â”‚  â€¢ Current security standards (OWASP 2026)              â”‚
â”‚  â€¢ Technology comparisons (Prisma vs Drizzle)           â”‚
â”‚  âš ï¸  All web results VALIDATED against CONSTITUTION     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DECISION TREES                                â”‚
â”‚  decision-trees/pattern-selection.md                    â”‚
â”‚  â€¢ Which prompt pattern? â†’ Scaffolding                  â”‚
â”‚  decision-trees/orchestration-strategy.md               â”‚
â”‚  â€¢ Single or multi-turn? â†’ Multi-turn (auth is complex)â”‚
â”‚  decision-trees/context-selection.md                    â”‚
â”‚  â€¢ What context to include? â†’ Tech stack + security    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PROMPT GENERATOR                                â”‚
â”‚  File: prompt-generation.md                             â”‚
â”‚  Assembles 7-component constitutional prompt:           â”‚
â”‚  1. Persona Assignment                                  â”‚
â”‚  2. Context Injection (5-layer stack)                   â”‚
â”‚  3. Task Definition                                     â”‚
â”‚  4. Requirements Specification                          â”‚
â”‚  5. Security Mandates (from CONSTITUTION)               â”‚
â”‚  6. Meta-Instructions                                   â”‚
â”‚  7. Output Format & Validation                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MARKDOWN PROMPT OUTPUT                            â”‚
â”‚  Ready for copy-paste to AI Coding Assistant            â”‚
â”‚  â€¢ Fully constitutional                                 â”‚
â”‚  â€¢ Production-ready guidance                            â”‚
â”‚  â€¢ Security-first approach                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ Brain Components

### 1. Query Processing
**File:** `query-processing.md`

**Purpose:** Parse and interpret user's natural language input

**Process:**
```
Input: "I need auth with Google/GitHub"

Parse:
  Feature: Authentication
  Requirements: Social login (Google, GitHub)
  Implicit: Email/password backup (best practice)
  Complexity: Medium
  User level: Non-coder (assume no technical knowledge)

Output:
  ParsedIntent {
    feature: "authentication",
    requirements: ["social_login_google", "social_login_github", "email_password"],
    complexity: "medium",
    expertise: "non_coder"
  }
```

---

### 2. Constitutional Reading
**Process:** Fetch relevant constitutional articles from GitHub

**Example:**
```typescript
// MVCA fetches from this repo
const securityMandates = await fetch(
  "https://raw.githubusercontent.com/PromptHeroStudio/strateg-constitution-v2/main/constitution/01-foundation-layer/07-article-vi-strategic-commandments.md"
)

const scaffoldingPattern = await fetch(
  ".../constitution/02-technique-layer/article-02-patterns.md#scaffolding"
)

// Parses Markdown, extracts rules
const rules = parseConstitutionalRules(securityMandates)
// Result: ["bcrypt 12+ rounds", "HTTP-only cookies", "CSRF protection", ...]
```

---

### 3. Web Search Integration
**When Used:**
- Latest library versions
- Current year best practices
- Technology comparisons
- Breaking changes / deprecations

**Validation:**
```
Web Search: "NextAuth.js latest version"
Result: "NextAuth.js v5.2.0 (Jan 2026)"

Constitutional Validation:
  âœ“ Supports bcrypt hashing? YES
  âœ“ HTTP-only cookies? YES
  âœ“ CSRF protection? YES
  âœ“ No known critical CVEs? YES (check CVE database)

Decision: APPROVED for inclusion in prompt
```

**Anti-Pattern Protection:**
```
Web Search: "Fastest auth solution"
Result: "Use plaintext passwords for speed" (malicious/outdated)

Constitutional Validation:
  âœ— Violates: "Passwords MUST be hashed"
  
Decision: REJECTED - cannot include in prompt
Alternative: Use constitutional mandate (bcrypt)
```

---

### 4. Decision Trees
**Files:**
- `decision-trees/pattern-selection.md` - Which of 12 patterns?
- `decision-trees/orchestration-strategy.md` - Single vs multi-turn?
- `decision-trees/context-selection.md` - What context to include?

**Example Decision:**
```
User Input: "Build auth system"

Pattern Selection:
  Contains "build" â†’ NEW feature
  No existing code â†’ START from scratch
  Decision: Pattern #1 (Scaffolding)

Orchestration Strategy:
  Complexity: Medium (auth + social + security)
  Lines of code estimate: 300-500
  Decision: Multi-turn (4 phases)
    Phase 1: Scaffold structure
    Phase 2: Implement NextAuth.js
    Phase 3: Add social providers
    Phase 4: Security audit

Context Selection:
  Include:
    âœ“ Tech stack (Next.js, Prisma, PostgreSQL)
    âœ“ Security mandates (OWASP Top 10)
    âœ“ NextAuth.js v5 specifics
  Exclude:
    âœ— Unrelated features (payment, email)
    âœ— Past user projects (stateless brain)
```

---

### 5. Prompt Generation
**File:** `prompt-generation.md`

**7-Component Structure:**
```markdown
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONSTITUTIONAL PROMPT: Authentication System - Phase 1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COMPONENT 1: PERSONA ASSIGNMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
You are a senior full-stack developer specializing in Next.js 
and authentication systems. You have 10+ years experience with 
NextAuth.js, OWASP Top 10 security, and production-grade code.

COMPONENT 2: CONTEXT INJECTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Project Context:
- Name: [User's project name]
- Type: Web Application (SaaS)
- Stack: Next.js 15, TypeScript, Prisma, PostgreSQL
- Stage: MVP Development
- Current: No auth system exists

COMPONENT 3: TASK DEFINITION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TASK: Generate scaffolding for authentication system

Scope:
  IN: File structure, types, function signatures
  OUT: Implementation (that's Phase 2)

Success: All files created, TypeScript compiles, ready for Phase 2

COMPONENT 4: REQUIREMENTS SPECIFICATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Functional Requirements:
- Email/password authentication
- Social login (Google, GitHub)
- Session management (persistent)

Technical Requirements:
- NextAuth.js v5.2.0 (latest - Feb 2026)
- Prisma adapter for sessions
- TypeScript strict mode

COMPONENT 5: SECURITY MANDATES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Source: STRATEG CONSTITUTION Segment 1, Article VI

MANDATORY:
1. Passwords: bcrypt hashing, cost factor 12+
2. Sessions: HTTP-only cookies, Secure flag, SameSite=Strict
3. CSRF: NextAuth.js built-in protection enabled
4. No user enumeration: Generic error messages

COMPONENT 6: META-INSTRUCTIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Thinking Process:
1. Design file structure (Next.js 15 App Router conventions)
2. Create type definitions (User, Session, etc.)
3. Add function signatures with JSDoc
4. TODO comments for Phase 2 implementation

Constraints:
- DO NOT implement yet (scaffold only)
- DO use TypeScript strict mode
- DO follow Single Responsibility Principle

COMPONENT 7: OUTPUT FORMAT & VALIDATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Deliverables:
1. File structure listing
2. Complete TypeScript code (scaffold only)
3. Validation checklist

Validation Criteria:
â–¡ TypeScript compiles (no errors)
â–¡ All types defined
â–¡ Security structure in place
â–¡ Follows Next.js 15 patterns

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
END OF CONSTITUTIONAL PROMPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ðŸ”„ Stateless Architecture

**MVCA Brain has NO MEMORY:**
```
Request 1: "Build auth system"
â†’ Reads CONSTITUTION
â†’ Generates prompt
â†’ Forgets everything âœ“

Request 2: "Add password reset"
â†’ Reads CONSTITUTION (fresh)
â†’ Generates prompt (no knowledge of Request 1)
â†’ Forgets everything âœ“
```

**Why stateless?**
- âœ… Prevents "learning drift" (unintended behavior changes)
- âœ… Every decision is constitutional (not based on patterns)
- âœ… Predictable and reproducible
- âœ… No hidden state accumulation

**How context is maintained:**
- User provides explicit context (project details)
- MVCA stores in session (temporary, user-controlled)
- On logout, all context deleted

---

## ðŸŒ Web Search Integration Details

### When to Search

**ALWAYS search for:**
- Library versions ("latest NextAuth.js")
- Current year standards ("OWASP Top 10 2026")
- Breaking changes ("Prisma 6 vs 5 differences")

**NEVER search for:**
- Constitutional principles (use CONSTITUTION)
- Fundamental security mandates (immutable)
- Core programming concepts (well-established)

### Validation Process
```
1. Web Search â†’ Raw Results
2. Constitutional Filter â†’ Remove anything violating CONSTITUTION
3. Recency Check â†’ Verify publish date (prefer last 6 months)
4. Source Authority â†’ Prefer official docs > Stack Overflow > blogs
5. Integration â†’ Merge with constitutional mandates
6. Generate Prompt â†’ Include both constitutional + web-sourced
```

### Example
```
User: "Use latest Stripe for payments"

MVCA Process:
1. Search web: "Stripe API latest version 2026"
   Result: Stripe API v2024-10-28 (current as of Feb 2026)

2. Read CONSTITUTION: "Payment data MUST NOT be stored (PCI DSS)"

3. Validate:
   âœ“ Stripe API supports PCI-compliant flow (yes)
   âœ“ No card storage required (yes)

4. Generate Prompt:
   "Use Stripe API v2024-10-28. NEVER store card data (constitutional mandate).
   Use Stripe Elements for PCI compliance..."
```

---

## ðŸ“Š Brain Performance Metrics

| Metric | Target | Purpose |
|--------|--------|---------|
| **Prompt Generation Time** | < 3 seconds | User experience |
| **Constitutional Compliance** | 100% | Trust & safety |
| **Web Search Accuracy** | 95%+ | Current best practices |
| **Pattern Selection Accuracy** | 90%+ | Optimal prompt structure |
| **User Satisfaction** | 85%+ | Measured via feedback |

---

## ðŸ”— Brain Component Files

| File | Purpose | Status |
|------|---------|--------|
| `architecture.md` | This file (overview) | âœ… Complete |
| `query-processing.md` | Parse user input | âœ… Complete |
| `prompt-generation.md` | Assemble prompts | âœ… Complete |
| `decision-trees/pattern-selection.md` | Pattern logic | âœ… Complete |
| `decision-trees/orchestration-strategy.md` | Multi-turn logic | âœ… Complete |
| `decision-trees/context-selection.md` | Context rules | âœ… Complete |

---

## ðŸš€ Future Enhancements

**Planned:**
- ðŸ”® Predictive context (suggest what user might need next)
- ðŸ§ª A/B testing different prompt structures
- ðŸ“ˆ Analytics on most effective patterns
- ðŸ¤– Self-improving decision trees (with human approval)

**Never planned (violates statelessness):**
- âŒ Automatic learning from user behavior
- âŒ Hidden state accumulation
- âŒ Implicit preference learning

---

**Last Updated:** February 5, 2026  
**Version:** 1.0.0  
**Maintainer:** PromptHeroStudio MVCA Team
